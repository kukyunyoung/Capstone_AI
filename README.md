# 다중 감정 분류 및 추론 시스템 (NLP 기반)

> 온라인 쇼핑 시 웹 검색뿐 아니라 유튜브 리뷰 영상을 참고하는 경우가 많습니다.
>
> 그러나 유튜버가 적극적으로 추천한 제품이 실제로는 기대에 미치지 못하는 경험을 해본 소비자들도 있을 것입니다.
>
> 저 역시 제품 구매 전 댓글을 꼼꼼히 확인하는 편인데, 긍정적인 의견이 ‘좋아요’를 많이 받아 상단에 노출되는 경우가 많아, 결과적으로 객관적인 판단이 어려워지는 문제를 발견했습니다.
>
> 이 문제를 해결하기 위해, 유튜브 댓글을 모두 수집하여 긍정 의견과 부정 의견을 동시에 제시하고 그 비율을 시각화하면 소비자가 보다 균형 잡힌 시각으로 구매 결정을 내릴 수 있을 것이라고 생각했습니다.
>
> <br><br>
>
> 본 프로젝트는 BERT 기반 NLP 모델을 활용하여 유튜브 댓글의 감정을 분석하는 시스템입니다.
>
> 모델은 긍정/부정/관련 없음 세 가지 범주로 댓글을 분류하며, 결과를 직관적으로 보여줍니다.
>
> 이를 통해 사용자는 리뷰나 광고성 콘텐츠에 대해 실제 소비자들의 반응을 객관적으로 이해할 수 있습니다.
>
> 제가 담당한 주요 역할은 모델 선택, 파인튜닝, 유튜브 댓글 크롤링 기능 개발, 훈련 데이터 제작, 데이터 전처리, 모델 학습입니다.
>
> 프로젝트는 Google Colab 환경에서 구동되며, 사용자가 HTML 인터페이스에 입력한 제품 정보(유튜브 동영상 ID)를 바탕으로 댓글 수집 → 데이터 정제 → 감정 분류 → 결과 시각화 과정을 수행합니다.
> 
> ## 문제 정의
> 유튜브 물품 리뷰를 통해 물건을 구매하고자 할 때 편향적인 영상들로 구매결정에 혼동을 줌.
> 
> 해당 영상의 댓글을 수집해 감성분류하는 모델을 사용해 분류하고 그 결과를 사용자에게 시각화해야함.
> ## 해결 방법 탐색
> 자연어처리에 유리한 모델을 사용해야 했기 때문에 한국어로 파인튜닝이 되어있고 양방향성을 가지고 문맥을 파악해 신뢰성이 높은 BERT 모델을 선택. 
> 
> 유튜브 영상 ID와 BeautifulSoap 라이브러리를 통해 유튜브 댓글 크롤링하여 긍정(1)/부정(0)/관련없음(2) 라벨링을 하고 해당 데이터로 모델 파인튜닝 진행.
> 
> 파인튜닝된 모델에게 실시간으로 크롤링된 댓글 데이터를 전달해 감성분류를 진행하고 그 결과를 사용자에게 시각화 해줌.
> ## 시행착오 및 개선
> 첫번째로 PDF 문서를 파싱하는 과정에서 인코딩 깨짐과 데이터 유실 문제가 발생했습니다.
>
> 초기에는 PDF를 단순히 텍스트 파일처럼 처리했지만, 실제로는 나무위키 인쇄물과 같은 비정형 PDF에서 글자 깨짐, 표·이미지 손실이 발생했습니다.
>
> 처음에는 PDF 파일을 단순히 텍스트라고 생각하고 작업을 진행했으나, 나무위키같은 PDF 인쇄물을 입력값으로 넣었을때 문제가 발생했습니다.
>
> 이 문제를 해결하기 위해 Poppler·Tesseract 기반의 UnstructuredPDFLoader 라이브러리를 도입하였고, 문서 특성에 따라 정형/비정형 PDF를 구분하여 서로 다른 로딩 방식을 적용했습니다.
>
> 그 결과, 텍스트가 올바르게 추출되고 표·이미지 기반 데이터까지 안정적으로 보존되어 데이터 유실 없는 파싱 파이프라인을 구축할 수 있었습니다.
>
> <br><br>
> 
> 두번째로 PDF 업로드를 통한 목차 생성 과정에서는 API 토큰 제한으로 인해 한 번에 전체 문서를 처리할 수 없는 문제가 발생했습니다.
> 
> 처음에는 긴 문서를 그대로 요청했으나, 응답이 잘리거나 누락되는 한계가 있었습니다. 이를 해결하기 위해 로직을 세 단계로 분리하였습니다.
> 
> 1. 목차 형식 추출 – PDF에서 제목·소제목만 뽑아 기본 구조를 생성.
> 2. 목차 머릿말 확장 – 추출된 목차 항목을 보완하여 각 파트의 개요를 채움.
> 3. 세부 내용 채우기 – 각 항목별로 내용을 분리 요청하여 순차적으로 완성.
>    
> 이 과정을 통해 토큰 제한을 우회하면서도 문서 전체에 대한 구조화된 목차와 세부 내용을 안정적으로 생성할 수 있었고, 사용자가 긴 문서도 효율적으로 탐색·활용할 수 있게 개선되었습니다.
> ## 추가 고려사항
> 군사시설이나 기업 환경은 클라우드 사용이 어려운 경우가 많아, 로컬 환경에서 동작 가능한 버전을 별도 제작.
> 
> GPU 성능 제약으로 모든 테스트를 완료하지는 못했지만, 보안 요건을 충족하는 온프레미스 AI 응용 가능성을 검증.



## 파일 설명

### 1. 다중감정분류\_nlp.py

- 감정 분석 모델을 학습하는 코드입니다.
- `KLUE/BERT` 모델을 활용하여 한국어 텍스트 감정 분류를 수행합니다.
- `TensorFlow` 및 `Transformers` 라이브러리를 사용합니다.
- 훈련 데이터 전처리, 토큰화, 모델 정의, 학습 및 저장 과정이 포함됩니다.

#### 주요 기능

1. 데이터 로드 및 전처리:
   - 유튜브 댓글 데이터를 로드 (`3952개 댓글.csv`)
   - '3952개 댓글.csv' 파일은 약 1000개의 댓글을 Data Augmentation 기법으로 증강한 데이터
   - 중복 제거, 결측값 처리, 특수 문자 제거
2. 데이터셋 분리:
   - `train_test_split`을 사용하여 학습 및 테스트 데이터셋으로 분리 (20% 테스트 데이터)
3. BERT 입력 데이터 변환:
   - 토큰화, 마스킹, 세그먼트 ID 처리
4. 모델 정의 및 학습:
   - `KLUE/BERT` 모델 활용
   - Softmax 활성화 함수를 사용한 다중 분류
   - 옵티마이저로 `Rectified Adam` 적용
   - 조기 종료(`EarlyStopping`) 및 체크포인트 저장(`ModelCheckpoint`)
5. 모델 저장:
   - 학습된 모델을 `best_model.pb` 파일로 저장

---

### 2. 캡스톤\_추론코드.py

- 학습된 감정 분석 모델을 사용하여 유튜브 댓글을 크롤링하고 감정을 예측하는 코드입니다.
- `Flask` 웹 애플리케이션을 통해 사용자가 유튜브 동영상 ID를 입력하면 해당 댓글을 분석하여 결과를 반환합니다.

#### 주요 기능

1. 유튜브 댓글 크롤링:
   - `Google API`를 활용하여 유튜브 영상 댓글을 가져옴
   - 최대 1000개의 댓글 수집 가능
   - 데이터를 `youtube_comments.xlsx`로 저장
2. 데이터 전처리:
   - 특수 문자 및 공백 제거
   - BERT 모델에 입력할 수 있도록 데이터 변환
3. 감정 예측:
   - 저장된 모델(`best_model.h5`)을 로드하여 감정 분류 수행
   - `argmax`를 활용해 최종 감정 레이블 (긍정/부정/관련 없음) 예측
4. 결과 분석:
   - 감정 분포 비율 계산 (긍정, 부정, 관련 없음)
   - 부정 및 긍정 댓글 샘플 제공
5. 웹 인터페이스 제공:
   - `Flask`를 사용하여 웹 애플리케이션 구축
   - 유튜브 영상 ID 입력 후 감정 분석 결과 출력

## 실행 방법

### 1. 감정 분석 모델 학습 (`다중감정분류_nlp.py` 실행)

```bash
python 다중감정분류_nlp.py
```

- 학습 완료 후 `best_model.pb` 파일이 생성됩니다.

### 2. 추론 및 웹 애플리케이션 실행 (`캡스톤_추론코드.py` 실행)

```bash
python 캡스톤_추론코드.py
```

- 웹 브라우저에서 `http://localhost:5000`으로 접속하여 유튜브 동영상 ID 입력 후 감정 분석 수행

## 참고사항

- 유튜브 댓글 크롤링을 위해 `Google API Key`가 필요합니다. (`get_comments` 함수 내 `DEVELOPER_KEY` 변경 필요)
- Colab 환경에서 실행합니다.


## 제작자

- **프로젝트 팀명**: 2023 조선대학교 1학기 컴퓨터공학과 캡스톤디자인 3팀
- **이메일**: kyy991022@gmail.com


