# 다중 감정 분류 및 추론 시스템 (NLP 기반)

> 온라인 쇼핑 시 웹 검색뿐 아니라 유튜브 리뷰 영상을 참고하는 경우가 많습니다.
>
> 그러나 유튜버가 적극적으로 추천한 제품이 실제로는 기대에 미치지 못하는 경험을 해본 소비자들도 있을 것입니다.
>
> 저 역시 제품 구매 전 댓글을 꼼꼼히 확인하는 편인데, 긍정적인 의견이 ‘좋아요’를 많이 받아 상단에 노출되는 경우가 많아, 결과적으로 객관적인 판단이 어려워지는 문제를 발견했습니다.
>
> 이 문제를 해결하기 위해, 유튜브 댓글을 모두 수집하여 긍정 의견과 부정 의견을 동시에 제시하고 그 비율을 시각화하면 소비자가 보다 균형 잡힌 시각으로 구매 결정을 내릴 수 있을 것이라고 생각했습니다.
>
> <br><br>
>
> 본 프로젝트는 BERT 기반 NLP 모델을 활용하여 유튜브 댓글의 감정을 분석하는 시스템입니다.
>
> 모델은 긍정/부정/관련 없음 세 가지 범주로 댓글을 분류하며, 결과를 직관적으로 보여줍니다.
>
> 이를 통해 사용자는 리뷰나 광고성 콘텐츠에 대해 실제 소비자들의 반응을 객관적으로 이해할 수 있습니다.
>
> 제가 담당한 주요 역할은 모델 선택, 파인튜닝, 유튜브 댓글 크롤링 기능 개발, 훈련 데이터 제작, 데이터 전처리, 모델 학습입니다.
>
> 프로젝트는 Google Colab 환경에서 구동되며, 사용자가 HTML 인터페이스에 입력한 제품 정보(유튜브 동영상 ID)를 바탕으로 댓글 수집 → 데이터 정제 → 감정 분류 → 결과 시각화 과정을 수행합니다.
> 
> ## 문제 정의
> 유튜브 물품 리뷰 영상은 대부분 긍정적이거나 광고 성격을 띠는 경우가 많아, 실제 소비자가 제품을 구매할 때 객관적인 판단을 방해하는 문제가 있음.
> 
> 리뷰 영상의 댓글 또한 ‘좋아요’를 많이 받은 긍정적인 의견이 상단에 노출되기 때문에, 사용자가 부정적 의견이나 중립적 의견을 놓치기 쉽다는 점에 주목.
>
> 따라서, **영상의 댓글 전체를 수집하여 감성 분류 모델로 분석하고, 그 결과를 긍정/부정/관련 없음의 비율과 구체적 사례로 시각화해 제공**한다면 소비자의 합리적인 구매결정에 도움을 줄 수 있을 것이라 판단함.
> ## 해결 방법 탐색
> 자연어처리 모델 중에서는 문맥을 양방향으로 파악할 수 있고, 한국어에 최적화된 파인튜닝 모델이 필요했습니다.
>
> 단순한 분류기(Logistic Regression, Naive Bayes 등)는 문맥 이해가 부족하다고 판단하여, Transformer 기반의 BERT 모델을 선택했습니다.
>
> 구현 과정은 다음과 같습니다.
>
> 1. 댓글 수집: 유튜브 영상 ID를 입력받아 BeautifulSoup 라이브러리로 댓글을 크롤링.
>
> 2. 데이터 라벨링: 수집된 댓글을 긍정(1)·부정(0)·관련 없음(2)으로 분류해 학습 데이터셋 구축.
>
> 3. 모델 파인튜닝: 한국어 BERT 모델을 기반으로 라벨링된 데이터셋으로 파인튜닝 진행.
>
> 4. 실시간 감성 분류: 파인튜닝된 모델에 실시간 크롤링한 댓글 데이터를 입력해 긍/부정/무관 분류 수행.
>
> 5. 시각화: 결과를 단순 비율뿐 아니라, 긍정·부정 댓글 샘플과 좋아요 수까지 함께 제시하여 사용자가 단순 통계가 아닌 실질적으로 신뢰할 수 있는 피드백을 확인하도록 구현.
>
> 이 과정을 통해 모델은 단순히 정확도를 높이는 데서 끝나지 않고, 실제 소비자가 구매를 고려할 때 의미 있는 인사이트를 제공할 수 있는 형태로 발전시킬 수 있었습니다.
> ## 시행착오 및 개선
> 첫번째로 파인튜닝을 위해 유튜브 댓글을 크롤링하여 긍정(1)·부정(0)·관련 없음(2)으로 직접 라벨링했는데, 초기에는 500개 데이터라벨링으로 하루를 투자해도 정확도가 70%에 머물렀습니다.
>
> 데이터가 부족하다는 한계를 느껴 Data Augmentation 기법을 도입했습니다.
>
> 이미 라벨링된 500개의 데이터에서 일부 문장을 삭제하거나 순서를 바꾸는 방식으로 변형해 약 4,000개의 데이터를 확보했습니다.
>
> 이 데이터를 다시 학습에 활용한 결과, 정확도가 평균 78%, 최대 85%까지 향상되며 성능 개선 효과를 확인할 수 있었습니다.
>
> <br><br>
> 
> 두번째로 감성 분류 결과를 단순히 **긍·부정·무관 비율(원 그래프)**로 제시했을 때는 사용자에게 충분한 설득력을 주지 못했습니다.
>
> 실제 분석에서는 긍정이 70~75%를 차지하고, 부정은 상대적으로 적었기 때문에 사용자가 “결국 대부분 긍정이잖아”라고 판단해 구매 결정에 큰 변화를 주지 못했습니다.
>
> 이를 해결하기 위해 결과 화면을 개선했습니다.
>
> 긍정과 부정 댓글을 나란히 제시하여 단순 비율이 아닌 실제 발화 내용을 직접 비교할 수 있도록 했습니다.
>
> 각 댓글에 달린 ‘좋아요’ 수를 함께 표시하여, 단순히 소수 의견이라도 공감을 많이 얻은 부정적 피드백은 실질적으로 신뢰할 만한 정보라는 점을 강조했습니다.
>
> 이러한 방식은 사용자가 제품 구매를 고려할 때 단순히 “긍정이 많다”는 통계적 정보가 아니라, 부정적인 의견 중에서도 얼마나 의미 있는 피드백이 있는지를 확인할 수 있게 해 주었습니다.
>
> 예를 들어, 긍정 75%라는 비율 속에서도 “배터리 성능이 너무 빨리 떨어진다”라는 부정 댓글이 좋아요 300개를 받았다면, 사용자는 해당 문제를 사전에 인지하고 더 신중한 결정을 내릴 수 있었습니다.



## 파일 설명

### 1. 다중감정분류\_nlp.py

- 감정 분석 모델을 학습하는 코드입니다.
- `KLUE/BERT` 모델을 활용하여 한국어 텍스트 감정 분류를 수행합니다.
- `TensorFlow` 및 `Transformers` 라이브러리를 사용합니다.
- 훈련 데이터 전처리, 토큰화, 모델 정의, 학습 및 저장 과정이 포함됩니다.

#### 주요 기능

1. 데이터 로드 및 전처리:
   - 유튜브 댓글 데이터를 로드 (`3952개 댓글.csv`)
   - '3952개 댓글.csv' 파일은 약 500개의 댓글을 Data Augmentation 기법으로 증강한 데이터
   - 중복 제거, 결측값 처리, 특수 문자 제거
2. 데이터셋 분리:
   - `train_test_split`을 사용하여 학습 및 테스트 데이터셋으로 분리 (20% 테스트 데이터)
3. BERT 입력 데이터 변환:
   - 토큰화, 마스킹, 세그먼트 ID 처리
4. 모델 정의 및 학습:
   - `KLUE/BERT` 모델 활용
   - Softmax 활성화 함수를 사용한 다중 분류
   - 옵티마이저로 `Rectified Adam` 적용
   - 조기 종료(`EarlyStopping`) 및 체크포인트 저장(`ModelCheckpoint`)
5. 모델 저장:
   - 학습된 모델을 `best_model.pb` 파일로 저장

---

### 2. 캡스톤\_추론코드.py

- 학습된 감정 분석 모델을 사용하여 유튜브 댓글을 크롤링하고 감정을 예측하는 코드입니다.
- `Flask` 웹 애플리케이션을 통해 사용자가 유튜브 동영상 ID를 입력하면 해당 댓글을 분석하여 결과를 반환합니다.

#### 주요 기능

1. 유튜브 댓글 크롤링:
   - `Google API`를 활용하여 유튜브 영상 댓글을 가져옴
   - 최대 1000개의 댓글 수집 가능
   - 데이터를 `youtube_comments.xlsx`로 저장
2. 데이터 전처리:
   - 특수 문자 및 공백 제거
   - BERT 모델에 입력할 수 있도록 데이터 변환
3. 감정 예측:
   - 저장된 모델(`best_model.h5`)을 로드하여 감정 분류 수행
   - `argmax`를 활용해 최종 감정 레이블 (긍정/부정/관련 없음) 예측
4. 결과 분석:
   - 감정 분포 비율 계산 (긍정, 부정, 관련 없음)
   - 부정 및 긍정 댓글 샘플 제공
5. 웹 인터페이스 제공:
   - `Flask`를 사용하여 웹 애플리케이션 구축
   - 유튜브 영상 ID 입력 후 감정 분석 결과 출력

## 실행 방법

### 1. 감정 분석 모델 학습 (`다중감정분류_nlp.py` 실행)

```bash
python 다중감정분류_nlp.py
```

- 학습 완료 후 `best_model.pb` 파일이 생성됩니다.

### 2. 추론 및 웹 애플리케이션 실행 (`캡스톤_추론코드.py` 실행)

```bash
python 캡스톤_추론코드.py
```

- 웹 브라우저에서 `http://localhost:5000`으로 접속하여 유튜브 동영상 ID 입력 후 감정 분석 수행

## 참고사항

- 유튜브 댓글 크롤링을 위해 `Google API Key`가 필요합니다. (`get_comments` 함수 내 `DEVELOPER_KEY` 변경 필요)
- Colab 환경에서 실행합니다.


## 제작자

- **프로젝트 팀명**: 2023 조선대학교 1학기 컴퓨터공학과 캡스톤디자인 3팀
- **이메일**: kyy991022@gmail.com


